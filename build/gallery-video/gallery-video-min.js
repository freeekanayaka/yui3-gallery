YUI.add("gallery-video",function(B){function D(){D.superclass.constructor.apply(this,arguments);}function G(L,K){return parseFloat(L);}B.mix(D,{NAME:"video-base",ATTRS:{src:{value:"",validator:B.Lang.isString},autoplay:{value:true,validator:B.Lang.isBoolean},mimeType:{value:"",validator:B.Lang.isString},codecs:{validator:B.Lang.isString},volume:{value:100,validator:function(K){return this._validatePercentage(K);},setter:G},totalTime:{writeOnce:true,validator:B.Lang.isNumber,setter:G},currentTime:{value:0,validator:B.Lang.isNumber,setter:G},totalBytes:{writeOnce:true,validator:B.Lang.isNumber,setter:G},currentBytes:{value:0,validator:B.Lang.isNumber,setter:G},percentLoaded:{value:0,validator:function(K){return this._validatePercentage(K);},setter:G}}});B.extend(D,B.Plugin.Base,{_videoNode:null,_validatePercentage:function(K){if(B.Lang.isNumber(K)===false){return false;}if(K>100||K<0){return false;}return true;},initializer:function(){this.afterHostEvent("render",B.bind(function(K){this._renderPlayer();this._bindPlayer();},this));},destructor:function(){},_renderPlayer:function(){},_bindPlayer:function(){this.after("volumeChange",B.rbind(this._handleVolumeChange,this,{source:"self"}));this.after("currentTimeChange",B.bind(this._handleCurrentTimeChange,this));},play:function(){},pause:function(){},stop:function(){},_handleCurrentTimeChange:function(){},_handleVolumeChange:function(){}});function C(){C.superclass.constructor.apply(this,arguments);}C.NAME="object-plugin";B.extend(C,D,{_createObjectNode:function(P,N,M,R,L){var Q='<object height="100%" width="100%" ',O=this.get("host"),K=O.get("contentBox");if(B.UA.ie){Q+='classid="'+M+'" codebase="'+R+'"';}else{Q+='data="'+P+'" type="'+N+'"';}Q+=">";B.Object.each(L,B.bind(function(U,S){var T=this._createParamNode(S,U);Q+=T;},this));Q+="</object>";K.set("innerHTML",Q);return K.one("object");},_createParamNode:function(K,L){var M='<param name="'+K+'" value="'+L+'">';return M;}});B.mix(B.Node.DOM_EVENTS,{abort:1,canplay:1,canplaythrough:1,durationchange:1,emptied:1,ended:1,error:1,loadeddata:1,loadedmetadata:1,loadstart:1,pause:1,play:1,playing:1,progress:1,ratechang:1,readystatechange:1,seeked:1,seeking:1,stalled:1,suspend:1,timeupdate:1,volumechange:1,waiting:1});function E(){E.superclass.constructor.apply(this,arguments);}B.mix(E,{NAME:"video-html5",NS:"player",checkCompatibility:function(O,K){if(B.UA.ie){return false;}try{var N=document.createElement("video"),L=N.canPlayType(O+(K?'; codecs="'+K:'"'));if(L=="maybe"||L=="probably"){return true;}}catch(M){}return false;}});B.extend(E,D,{_manualProgressInterval:null,_renderPlayer:function(){E.superclass._renderPlayer.apply(this,arguments);var M=B.Node.create('<video width="100%" height="100%"></video>'),O=B.Node.create("<source></source>"),N=this.get("host"),K=N.get("contentBox"),Q=this.get("src"),P=this.get("mimeType"),L=this.get("codecs");O.setAttrs({src:Q,type:P+"; "+(L?'codecs="'+L:'"')});if(this.get("autoplay")===true){M.setAttribute("autoplay","");}M.append(O);K.append(M);this._videoNode=M;},_bindPlayer:function(){E.superclass._bindPlayer.apply(this,arguments);var K=this._videoNode,N=B.Node.getDOMNode(K),M=0,L=this.get("host");this.after("percentLoadedChange",B.bind(function(O){if(O.newVal>=100&&this._manualProgressInterval){this._manualProgressInterval.cancel();}},this));if(N.buffered){this._manualProgressInterval=B.later(500,this,function(){var O=this.get("percentLoaded"),P=(N.buffered.end()*100)/N.duration;if(O==P){M++;}else{M=0;}this.set("percentLoaded",P);L.fire("progress");if(M>10){M=0;this._manualProgressInterval.cancel();}},null,true);}K.after("progress",B.bind(function(P){var O=(P._event.loaded*100)/P._event.total;this.set("currentBytes",P._event.loaded);this.set("totalBytes",P._event.total);this.set("percentLoaded",O);L.fire("progress");},this));K.after("timeupdate",B.bind(function(){this.set("currentTime",N.currentTime,{source:"self"});L.fire("playheadUpdate");},this));K.after("canplay",function(){L.fire("canPlay");});K.after("ended",function(){L.fire("ended");});K.after("loadeddata",B.bind(function(O){this.set("totalTime",N.duration);L.fire("loadedMetadata");},this));K.after("play",function(){L.fire("play");});K.after("pause",function(){L.fire("pause");});K.after("volumechange",B.bind(function(){var P=N.volume,O=Math.floor(P*100);this.set("volume",O);},this));},play:function(){B.Node.getDOMNode(this._videoNode).play();},pause:function(){B.Node.getDOMNode(this._videoNode).pause();},stop:function(){var K=B.Node.getDOMNode(this._videoNode);K.pause();K.currentTime=0;},_handleCurrentTimeChange:function(L,K){if(!L.source||L.source!="self"){B.Node.getDOMNode(this._videoNode).currentTime=L.newVal;}},_handleVolumeChange:function(L,K){if(K.source=="self"){var M=L.newVal/100;B.Node.getDOMNode(this._videoNode).volume=M;}}});B.VideoHTML5=E;var H=new B.EventTarget();H.publish("flashEvent");function A(){A.superclass.constructor.apply(this,arguments);}B.mix(A,{NAME:"video-flash",NS:"player",EVENT_MAP:{"complete":"ended","metadataReceived":"loadedMetadata","playheadUpdate":"playheadUpdate","bytesLoadedChange":"progress","ready":"canPlay","play":"play","pause":"pause"},MIME_TYPES:["video/x-flv","video/mp4","video/quicktime","video/x-m4v"],CID:"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",CODEBASE:"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,115",flashEventTarget:H,checkCompatibility:function(L,K){if(B.Array.indexOf(B.VideoFlash.MIME_TYPES,L)>-1){if(K&&/avc/.test(K)===false&&L!="video/x-flv"){return false;}}else{return false;}if(!B.UA.flashMajor||B.UA.flashMajor<9){return false;}return true;}});YUI.galleryVideoListener=function(L,K){B.VideoFlash.flashEventTarget.fire("flashEvent",{id:L,event:K});};B.extend(A,C,{initializer:function(){var K=this.get("host");A.flashEventTarget.on("flashEvent",function(L){if(L.id==K.get("id")){K.fire(A.EVENT_MAP[L.event]);}});},_renderPlayer:function(){A.superclass._renderPlayer.apply(this,arguments);var M=this.get("host"),N=this.get("src"),L=B.Video.SWF_PLAYER_SRC,K={loop:"true",menu:"true",quality:"best",scale:"showall",salign:"tl",wmode:"opaque",bgcolor:"#000000",allowScriptAccess:"always",allowNetworking:"all",allowFullScreen:"true",flashVars:B.QueryString.stringify({file:N,playerId:M.get("id"),jsCallback:"YUI.galleryVideoListener"})};
if(B.UA.ie){K.movie=L;}this._videoNode=this._createObjectNode(L,"application/x-shockwave-flash",A.CID,A.CODEBASE,K);},play:function(){B.Node.getDOMNode(this._videoNode).play();},pause:function(){B.Node.getDOMNode(this._videoNode).pause();},stop:function(){B.Node.getDOMNode(this._videoNode).stop();},getCurrentTime:function(){return B.Node.getDOMNode(this._videoNode).getCurrentTime();},setCurrentTime:function(L){if(B.Lang.isNumber(L)===false){return false;}var K=B.Node.getDOMNode(this._videoNode);K.setCurrentTime(L);},getTotalTime:function(){return B.Node.getDOMNode(this._videoNode).getTotalTime();},_handleVolumeChange:function(L,K){if(K.source=="self"){var M=L.newVal/100;B.Node.getDOMNode(this._videoNode).setVolume(M);}}});B.VideoFlash=A;B.mix(B.Node.DOM_EVENTS,{"qt_begin":1,"qt_loadedmetadata":1,"qt_loadedfirstframe":1,"qt_canplay":1,"qt_canplaythrough":1,"qt_durationchange":1,"qt_load":1,"qt_ended":1,"qt_error":1,"qt_pause":1,"qt_play":1,"qt_progress":1,"qt_waiting":1,"qt_stalled":1,"qt_timechanged":1,"qt_volumechange":1});function F(){F.superclass.constructor.apply(this,arguments);}B.mix(F,{NAME:"video-quicktime",NS:"player",ATTRS:{timeScale:{validator:B.Lang.isNumber,writeOnce:true,readOnly:true}},MIME_TYPES:["video/quicktime","video/x-msvideo","video/msvideo","video/avi","video/flc","video/x-mpeg","video/mpeg","video/3gpp","video/3gpp2","video/sd-video","video/mp4","video/x-m4v"],CID:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",CODEBASE:"http://www.apple.com/qtactivex/qtplugin.cab",checkCompatibility:function(P){if(B.Array.indexOf(F.MIME_TYPES,P)<0){return false;}var N,M,K,O;if(!B.UA.quicktime){try{if(navigator.mimeTypes){N=navigator.mimeTypes["video/quicktime"];if(N&&N.enabledPlugin){N=N.enabledPlugin;}}if(N){K=N.version||N.name.match(/[^\w\d][\d][\d\.\_,\-]*/gi)[0];}else{if(window.ActiveXObject){O=new window.ActiveXObject("QuickTime.QuickTime");K=O.GetQuickTimeVersion();}}if(K){M=K.split(/[\.\_,\-]/g);K=M[0]+"."+M[1]+M[2];B.UA.quicktime=parseFloat(K);}}catch(L){}}if(!B.UA.quicktime||B.UA.quicktime<7){return false;}return true;}});B.extend(F,C,{_useQTDOMEvents:false,_rate:0,_pluginStatusInterval:null,_playheadInterval:null,initializer:function(){this._useQTDOMEvents=(B.UA.ie===0&&B.UA.quicktime>7.2);},_renderPlayer:function(){var M=this.get("src"),L=this.get("mimeType"),K={showlogo:false,autoplay:this.get("autoplay"),enablejavascript:true,postdomevents:true,kioskmode:false,scale:"aspect",cache:true,controller:false};if(B.UA.ie){K.src=M;}this._videoNode=this._createObjectNode(M,L,F.CID,F.CODEBASE,K);if(this._useQTDOMEvents===false){this._startPluginStatusInterval();}},_bindPlayer:function(){F.superclass._bindPlayer.apply(this,arguments);var L=this._videoNode,O=B.Node.getDOMNode(L),N=this.get("host");function K(){var P=B.Node.getDOMNode(L).GetRate();if(P===1){N.fire("play");}else{N.fire("pause");}}function M(){var R=O.GetMaxBytesLoaded(),Q=this.get("totalBytes"),P=(R*100)/Q;this.set("currentBytes",R);this.set("percentLoaded",P);N.fire("progress");}N.after("play",B.bind(function(){this._startPlayheadInterval();},this));N.after("pause",B.bind(function(){this._clearPlayheadInterval();},this));if(this._useQTDOMEvents===true){if(B.Lang.isFunction(O.GetPluginStatus)&&O.GetPluginStatus()=="Complete"){this._setConstants();this.set("currentBytes",O.GetMovieSize());this.set("percentLoaded",100);N.fire("progress");if(this.get("autoplay")===true){N.fire("play");}}else{L.on("qt_loadedmetadata",B.bind(function(){this._setConstants();},this));L.on("qt_progress",B.bind(M,this));L.on("qt_load",B.bind(M,this));}L.on("qt_canplay",function(){N.fire("canPlay");});L.on("qt_ended",function(){N.fire("ended");});L.on("qt_timechanged",function(){N.fire("playheadUpdate");});L.on("qt_play",function(){N.fire("play");});L.on("qt_pause",function(){N.fire("pause");});L.on("qt_volumechange",B.bind(function(){var R=O.GetVolume(),P=256,Q=Math.floor((R/P)*100);this.set("volume",Q);},this));}else{this.after("playheadUpdate",B.bind(function(){var P=O.GetRate();if(P===0&&this._rate!==0){if(Math.ceil(this.getCurrentTime())==Math.ceil(this._duration)){N.fire("pause");N.fire("ended");}}this._rate=P;},this));L.on("click",B.bind(K,this));L.on("dblclick",B.bind(K,this));}},_startPluginStatusInterval:function(){if(!this._pluginStatusInterval){var K=this,L=this.get("host"),N=B.Node.getDOMNode(this._videoNode),M=this.get("autoplay");this._pluginStatusInterval=setInterval(function(){try{var O=N.GetPluginStatus(),R=N.GetMaxBytesLoaded(),Q=K.get("totalBytes");K.set("currentBytes",R);K.set("percentLoaded",(R*100)/Q);if(O=="Loading"){L.fire("progress");}else{if(O=="Playable"||O=="Complete"){K._clearPluginStatusInterval();L.fire("canPlay");K._setConstants();if(M===true){L.fire("play");}}}}catch(P){}},100);}},_clearPluginStatusInterval:function(){clearInterval(this._pluginStatusInterval);this._pluginStatusInterval=null;},_startPlayheadInterval:function(){if(!this._playheadInterval){var L=this.get("host"),N=B.Node.getDOMNode(this._videoNode),M=this.get("timeScale"),K=this;this._playheadInterval=setInterval(function(){K.set("currentTime",N.GetTime()/M,{source:"self"});L.fire("playheadUpdate");},300);}},_clearPlayheadInterval:function(){clearInterval(this._playheadInterval);this._playheadInterval=null;},play:function(){var K=this.get("host");if(this._useQTDOMEvents===false){K.fire("play");}B.Node.getDOMNode(this._videoNode).Play();},pause:function(){var K=this.get("host");if(this._useQTDOMEvents===false){K.fire("pause");}B.Node.getDOMNode(this._videoNode).Stop();},stop:function(){this.pause();B.Node.getDOMNode(this._videoNode).SetTime(0);},_setConstants:function(){var N=B.Node.getDOMNode(this._videoNode),K=this.get("host"),M=N.GetTimeScale(),O=N.GetDuration()/M,L=N.GetMovieSize();this.set("timeScale",M);this.set("totalTime",O);this.set("totalBytes",L);K.fire("loadedMetadata");},_handleCurrentTimeChange:function(M,K){if(!M.source||M.source!="self"){var L=this.get("timeScale");B.Node.getDOMNode(this._videoNode).SetTime(Math.ceil(M.newVal*L));}},_handleVolumeChange:function(N,L){if(L.source=="self"){var K=256,M=N.newVal/100,O=Math.floor(K*M);
B.Node.getDOMNode(this._videoNode).SetVolume(O);}}});B.VideoQuicktime=F;function J(){J.superclass.constructor.apply(this,arguments);}B.mix(J,{NAME:"video-controls",NS:"controls"});B.extend(J,B.Plugin.Base,{initializer:function(){}});function I(K){I.superclass.constructor.apply(this,arguments);}B.mix(I,{NAME:"video",SWF_PLAYER_SRC:"assets/player.swf",RENDER_ORDER:["html5","quicktime","flash"],ATTRS:{media:{validator:function(K){return this._validateMedia(K);}},autoCreate:{value:true,validator:B.Lang.isBoolean}}});B.extend(I,B.Widget,{initializer:function(){B.publish("canPlay");B.publish("ended");B.publish("loadedMetadata");B.publish("progress");B.publish("playheadUpdate");B.publish("error");B.publish("pause");B.publish("play");if(this.get("autoCreate")===true){this._findPlayer();}},_findPlayer:function(){var L=this.get("media"),M={html5:E,flash:A,quicktime:F},K;B.Array.some(L,B.bind(function(N){B.Array.some(B.Video.RENDER_ORDER,function(O){K=M[O];var P=K.checkCompatibility(N.mimeType,N.codecs);if(P===false){K=null;}return P;});if(K){this.plug(K,N);return true;}},this));},_validateMedia:function(K){if(B.Lang.isArray(K)===true){return true;}return false;}});B.Video=I;},"@VERSION@",{requires:["node","widget","substitute","swfdetect","querystring-stringify","plugin"]});