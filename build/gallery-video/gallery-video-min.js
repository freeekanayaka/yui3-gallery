YUI.add("gallery-video",function(C){function E(){E.superclass.constructor.apply(this,arguments);}C.mix(E,{NAME:"video",ATTRS:{mimeType:{value:"",validator:C.Lang.isString},src:{value:"",validator:C.Lang.isString},autoplay:{value:true,validator:C.Lang.isBoolean},defaultControls:{value:false,validator:C.Lang.isBoolean},media:{value:null,validator:function(J){return this._validateMedia(J);}},volume:{value:100,validator:function(J){return this._validateVolume(J);},setter:function(K,J){return parseInt(K,10);}}}});var D='<video width="100%" height="100%" '+"{autoplay} "+"{controls}>"+"{source}"+"</video>",H="<source "+'src="{src}" '+'type="{typeDef}" '+"{media}>",I='<object width="{width}" height="{height}" '+'data="{src}" '+'codebase="{codebase}" '+'classid="{classid}" '+'type="{mimeType}" '+'style="{style}">'+"{params}"+"</object>",B='<param name="{name}" value="{value}">';C.extend(E,C.Widget,{_videoNode:null,_validateMedia:function(J){return true;},_validateVolume:function(J){if(C.Lang.isNumber(J)===false){return false;}if(J>100||J<0){return false;}return true;},_checkPlugin:function(){return true;},_publishEvents:function(){C.publish("canPlay");C.publish("ended");C.publish("loadedMetadata");C.publish("progress");C.publish("playheadUpdate");C.publish("error");C.publish("pause");C.publish("play");},initializer:function(){this._publishEvents();this._checkPlugin();},destructor:function(){},_createParams:function(K){var J="";C.each(K,function(N,L,M){J+=C.substitute(B,{name:L,value:String(N)});});return J;},_renderPlayer:function(){},_bindPlayer:function(){this.after("volumeChange",C.rbind(this._handleVolumeChange,this,{source:"self"}));},renderUI:function(){this._renderPlayer();},bindUI:function(){this._bindPlayer();},syncUI:function(){},play:function(){},pause:function(){},stop:function(){},getTotalTime:function(){},getCurrentTime:function(){},setCurrentTime:function(J){},_handleVolumeChange:function(){}});C.mix(C.Node.DOM_EVENTS,{abort:1,canplay:1,canplaythrough:1,durationchange:1,emptied:1,ended:1,error:1,loadeddata:1,loadedmetadata:1,loadstart:1,pause:1,play:1,playing:1,progress:1,ratechang:1,readystatechange:1,seeked:1,seeking:1,stalled:1,suspend:1,timeupdate:1,volumechange:1,waiting:1});function G(){G.superclass.constructor.apply(this,arguments);}C.mix(G,{NAME:"video-html5"});C.extend(G,E,{_renderPlayer:function(){var M=this.get("contentBox"),O=this.get("media"),P="",L,K,N=0,J=O.length;for(;N<J;N++){P+=C.substitute(H,{src:O[N].src,typeDef:O[N].mimeType+";",media:""});}L=C.substitute(D,{poster:"",autoplay:(this.get("autoplay")===true?"autoplay":""),preload:"",loop:"",controls:"controls",source:P});K=C.Node.create(L);M.append(K);this._videoNode=K;},_bindPlayer:function(){G.superclass._bindPlayer.apply(this,arguments);var J=this._videoNode;J.on("timeupdate",C.bind(function(){this.fire("playheadUpdate");},this));J.on("canplay",C.bind(function(){this.fire("canPlay");},this));J.on("ended",C.bind(function(){this.fire("ended");},this));J.on("loadedmetadata",C.bind(function(){this.fire("loadedMetadata");},this));J.on("progress",C.bind(function(){this.fire("progress");},this));J.on("volumechange",C.bind(function(){var L=C.Node.getDOMNode(J).volume,K=Math.floor(L*100);this.set("volume",K);},this));},play:function(){C.Node.getDOMNode(this._videoNode).play();},pause:function(){C.Node.getDOMNode(this._videoNode).pause();},stop:function(){var J=C.Node.getDOMNode(this._videoNode);J.pause();J.currentTime=0;},getTotalTime:function(){return C.Node.getDOMNode(this._videoNode).duration;},getCurrentTime:function(){return C.Node.getDOMNode(this._videoNode).currentTime;},setCurrentTime:function(K){if(C.Lang.isNumber(K)===false){return false;}var J=C.Node.getDOMNode(this._videoNode);J.currentTime=K;},_handleVolumeChange:function(K,J){if(J.source=="self"){var L=K.newVal/100;C.Node.getDOMNode(this._videoNode).volume=L;}}});function A(){A.superclass.constructor.apply(this,arguments);}C.mix(A,{NAME:"video-flash",EVENT_MAP:{"complete":"ended","metadataReceived":"loadedMetadata","currentTimeChange":"playheadUpdate","bytesLoadedChange":"progress","ready":"canPlay","play":"play","pause":"pause","mediaPlayerStateChange":"stateChange"}});(function(){var J=new C.EventTarget();J.publish("flashEvent");C.mix(A,{flashEventTarget:J});})();YUI.galleryVideoListener=function(K,J){A.flashEventTarget.fire("flashEvent",{id:K,event:J});};C.extend(A,E,{initializer:function(){A.superclass.initializer.apply(this,arguments);A.flashEventTarget.on("flashEvent",C.bind(function(J){if(J.id==this.get("id")){this.fire(A.EVENT_MAP[J.event]);}},this));},_renderPlayer:function(){var L=this.get("contentBox"),M=this.get("media")[0],O=C.Video.SWF_PLAYER_SRC,N={movie:O,loop:"true",menu:"true",quality:"best",scale:"showall",salign:"tl",wmode:"opaque",bgcolor:"#000000",allowScriptAccess:"always",allowNetworking:"all",allowFullScreen:"true",flashVars:C.QueryString.stringify({file:M.src,width:this.get("width"),height:this.get("height"),playerId:this.get("id"),jsCallback:"YUI.galleryVideoListener"})},K=C.substitute(I,{src:O,codebase:"",classid:"",width:this.get("width"),height:this.get("height"),mimeType:"application/x-shockwave-flash",params:this._createParams(N)}),J=C.Node.create(K);L.append(J);this._videoNode=J;},play:function(){C.Node.getDOMNode(this._videoNode).play();},pause:function(){C.Node.getDOMNode(this._videoNode).pause();},stop:function(){C.Node.getDOMNode(this._videoNode).stop();},getCurrentTime:function(){return C.Node.getDOMNode(this._videoNode).getCurrentTime();},setCurrentTime:function(K){if(C.Lang.isNumber(K)===false){return false;}var J=C.Node.getDOMNode(this._videoNode);J.setCurrentTime(K);},getTotalTime:function(){return C.Node.getDOMNode(this._videoNode).getTotalTime();},_handleVolumeChange:function(K,J){if(J.source=="self"){var L=K.newVal/100;C.Node.getDOMNode(this._videoNode).setVolume(L);}}});C.mix(C.Node.DOM_EVENTS,{"qt_canplay":1,"qt_ended":1,"qt_loadedmetadata":1,"qt_progress":1,"qt_timechanged":1,"qt_play":1,"qt_pause":1,"qt_volumechange":1});
function F(){F.superclass.constructor.apply(this,arguments);}C.mix(F,{NAME:"video-quicktime"});C.extend(F,E,{_timeScale:null,_duration:null,_useQTDOMEvents:false,_rate:0,_pluginStatusInterval:null,_playheadInterval:null,_checkPlugin:function(){if(navigator.plugins){C.Array.each(navigator.plugins,C.bind(function(L,K,M){if(L.name&&L.name.toLowerCase().search("quicktime")>-1){if(L.version){var J=L.version.split(".").join("");if(J<700){return false;}if(J>=721){this._useQTDOMEvents=true;}}return true;}},this));}},_renderPlayer:function(){var L=this.get("contentBox"),N=this.get("media")[0],P=N.src,O=N.mimeType,M={src:P,showlogo:false,autoplay:this.get("autoplay"),enablejavascript:true,postdomevents:true,kioskmode:false,scale:"aspect",cache:true,controller:true},K=C.substitute(I,{src:P,codebase:"",classid:"",mimeType:O,style:"",params:this._createParams(M)}),J=C.Node.create(K);L.append(J);this._videoNode=J;if(this._useQTDOMEvents===false){this._startPluginStatusInterval();}},_bindPlayer:function(){F.superclass._bindPlayer.apply(this,arguments);var K=this._videoNode;function J(){var L=C.Node.getDOMNode(K).GetRate();if(L===1){this.fire("play");}else{this.fire("pause");}}if(this._useQTDOMEvents===true){K.on("qt_canplay",C.bind(function(){this.fire("canPlay");},this));K.on("qt_ended",C.bind(function(){this.fire("ended");},this));K.on("qt_loadedmetadata",C.bind(function(){this._setTimeConstants();this.fire("loadedMetadata");},this));K.on("qt_progress",C.bind(function(){this.fire("progress");},this));K.on("qt_timechanged",C.bind(function(){this.fire("playheadUpdate");},this));K.on("qt_play",C.bind(function(){this.fire("play");},this));K.on("qt_pause",C.bind(function(){this.fire("pause");},this));K.on("qt_volumechange",C.bind(function(){var N=C.Node.getDOMNode(K).GetVolume(),L=256,M=Math.floor((N/L)*100);this.set("volume",M);},this));}else{this.after("playheadUpdate",C.bind(function(){var L=C.Node.getDOMNode(K).GetRate();if(L===0&&this._rate!==0){if(Math.ceil(this.getCurrentTime())==Math.ceil(this._duration)){this.fire("pause");this.fire("ended");}}this._rate=L;},this));K.on("click",C.bind(J,this));K.on("dblclick",C.bind(J,this));}this.after("play",C.bind(function(){this._startPlayheadInterval();},this));this.after("pause",C.bind(function(){this._clearPlayheadInterval();},this));},_startPluginStatusInterval:function(){if(!this._pluginStatusInterval){var J=this,L=C.Node.getDOMNode(this._videoNode),K=this.get("autoplay");this._pluginStatusInterval=setInterval(function(){try{var M=L.GetPluginStatus();if(M=="Loading"){this.fire("progress");}else{if(M=="Playable"||M=="Complete"){this.fire("canPlay");this._setTimeConstants();J.fire("loadedMetadata");if(K===true){J.fire("play");}J._clearPluginStatusInterval();}}}catch(N){}},100);}},_clearPluginStatusInterval:function(){clearInterval(this._pluginStatusInterval);this._pluginStatusInterval=null;},_startPlayheadInterval:function(){if(!this._playheadInterval){var J=this;this._playheadInterval=setInterval(function(){J.fire("playheadUpdate");},300);}},_clearPlayheadInterval:function(){clearInterval(this._playheadInterval);this._playheadInterval=null;},play:function(){if(this._useQTDOMEvents===false){this.fire("play");}C.Node.getDOMNode(this._videoNode).Play();},pause:function(){if(this._useQTDOMEvents===false){this.fire("pause");}C.Node.getDOMNode(this._videoNode).Stop();},stop:function(){this.pause();C.Node.getDOMNode(this._videoNode).SetTime(0);},_setTimeConstants:function(){var J=C.Node.getDOMNode(this._videoNode);this._timeScale=J.GetTimeScale();this._duration=J.GetDuration()/this._timeScale;},getTotalTime:function(){return this._duration;},getCurrentTime:function(){var K=C.Node.getDOMNode(this._videoNode),J=K.GetTime(),L=J/this._timeScale;return L;},setCurrentTime:function(L){if(C.Lang.isNumber(L)===false){return false;}var K=C.Node.getDOMNode(this._videoNode),J=Math.ceil(L*this._timeScale);K.SetTime(J);},_handleVolumeChange:function(M,K){if(K.source=="self"){var J=256,L=M.newVal/100,N=Math.floor(J*L);C.Node.getDOMNode(this._videoNode).SetVolume(N);}}});(function(){function K(R){K.superclass.constructor.call(this);if(!R||!R.media){return false;}var S=0,Q=R.media.length;for(;S<Q;S++){R.media[S].index=this._checkEnvironment(R.media[S].mimeType);}R.media.sort(function(U,T){return U.index>T.index;});this._buildPlayer(R.media[0].index,R);}var N=["html5","flash","quicktime"],O={MOV:1,FLV:2,MP4:3,M4V:4,MPEG:5,OGG:6},J={"video/quicktime":O.MOV,"video/mp4":O.MP4,"video/mpeg":O.MPEG,"video/x-m4v":O.M4V,"video/x-flv":O.FLV,"video/ogg":O.OGG},P={GECKO:[O.OGG],OPERA:[O.OGG],WEBKIT:[O.MP4,O.MOV,O.MPEG,O.M4V]},M=[O.MP4,O.MOV,O.M4V,O.FLV],L={html5:G,flash:A,quicktime:F};C.mix(K,{SWF_PLAYER_SRC:"assets/player.swf"});C.extend(K,C.Base,{_widget:null,initializer:function(){C.publish("canPlay");C.publish("ended");C.publish("loadedMetadata");C.publish("progress");C.publish("playheadUpdate");C.publish("error");},_checkEnvironment:function(R){var Q=J[R];if(C.UA.gecko>0){if(C.UA.gecko>=1.91&&C.Array.indexOf(P.GECKO,Q)>-1){return C.Array.indexOf(N,"html5");}else{if(C.UA.flashMajor>9){return C.Array.indexOf(N,"flash");}else{return C.Array.indexOf(N,"quicktime");}}}else{if(C.UA.opera>0){if(C.UA.opera>=10.5&&C.Array.indexOf(P.OPERA,Q)>-1){return C.Array.indexOf(N,"html5");}else{return C.Array.indexOf(N,"quicktime");}}else{if(C.UA.webkit>0){if(C.UA.webkit>=525.25&&C.Array.indexOf(P.WEBKIT,Q)>-1){return C.Array.indexOf(N,"html5");}else{return C.Array.indexOf(N,"quicktime");}}else{if(C.UA.ie>0){}else{return -1;}}}}},_buildPlayer:function(R,Q){if(!N[R]){return false;}this._widget=new L[N[R]](Q);},getPlayer:function(){return this._widget;},render:function(){this._widget.render.apply(this._widget,arguments);},play:function(){this._widget.play();},pause:function(){this._widget.pause();},stop:function(){this._widget.stop();}});C.Video=K;})();},"@VERSION@",{requires:["node","widget","substitute","swfdetect","querystring-stringify"]});